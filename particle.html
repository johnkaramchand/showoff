<html>
<head>
  <style>
    body{
      background-color: #ffffff;
    }
    body,html, canvas{
      width:100%;
      height:100%;
      padding:0;
      margin:0;
      overflow: hidden;
    }
  </style>
</head>
<body>

  <!-- canvas element  -->

    <canvas id="map"></canvas>

  <!-- libraries -->

    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r72/three.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js'></script>

  <!-- scripting -->

    <script>

      //VARIABLES

      var renderer, scene, camera,particles;
      var centerVector = new THREE.Vector3(0, 0, 0);
      var previousTime = 0;


      //READING CANVAS ELEMENT

      var getImageData = function(image) {

      	var canvas = document.createElement("canvas");
      	canvas.width = image.width;
      	canvas.height = image.height;

      	var ctx = canvas.getContext("2d");
      	ctx.drawImage(image, 0, 0);

      	return ctx.getImageData(0, 0, image.width, image.height);
      }

      //DRAWING THE IMAGE
      var drawTheMap = function() {

      	var geometry = new THREE.Geometry();
      	var material = new THREE.PointsMaterial({
      		size: 2,
      		color: 0xffffff,
      		sizeAttenuation: false
      	});
      	for (var y = 0, y2 = imagedata.height; y < y2; y += 2) {
      		for (var x = 0, x2 = imagedata.width; x < x2; x += 2) {
      			if (imagedata.data[(x * 4 + y * 4 * imagedata.width) + 3] > 128) {

      				var vertex = new THREE.Vector3();
      				vertex.x = x - imagedata.width / 2;
      				vertex.y = -y + imagedata.height / 2;
      				vertex.z = 0;

      				vertex.destination = {
      					x: x - imagedata.width / 2,
      					y: -y + imagedata.height / 2,
      					z: 0
      				};

      				vertex.speed = Math.random() / 200 + 0.015;

      				geometry.vertices.push(vertex);
      			}
      		}
      	}
        particles = new THREE.Points(geometry, material);

      	scene.add(particles);

      	requestAnimationFrame(render);
      };

      //INIT FUNCTION

      var init = function() {
      	THREE.ImageUtils.crossOrigin = '';
      	renderer = new THREE.WebGLRenderer({
      		canvas: document.getElementById("map"),
      		antialias: true
      	});
      	renderer.setSize(window.innerWidth, window.innerHeight);
      	renderer.setClearColor(0x000000);

      	scene = new THREE.Scene();

      	camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
      	camera.position.set(-100, 0, 220);
      	camera.lookAt(centerVector);
      	scene.add(camera);

      	texture = THREE.ImageUtils.loadTexture("apps.png", undefined, function() {
      		imagedata = getImageData(texture.image);
      		drawTheMap();

      	});
        window.addEventListener('resize', onResize, false);

      };

      var onResize = function(){

      	renderer.setSize(window.innerWidth, window.innerHeight);
          camera.aspect = window.innerWidth/ window.innerHeight;
          camera.updateProjectionMatrix();
      };
     //RENDER
      var render = function(a) {

      	requestAnimationFrame(render);

      	for (var i = 0, j = particles.geometry.vertices.length; i < j; i++) {

      		var particle = particles.geometry.vertices[i];
      		particle.x += (particle.destination.x - particle.x) * particle.speed;
      		particle.y += (particle.destination.y - particle.y) * particle.speed;
      		particle.z += (particle.destination.z - particle.z) * particle.speed;
      	}

      	particles.geometry.verticesNeedUpdate = true;
      	camera.position.x = Math.sin(a / 5000) * 100;
      	camera.lookAt(centerVector);

      	renderer.render(scene, camera);
      };

      init();

    </script>
</body>
</html>
<!-- end -->
